<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>System - Sign in With Apple 구현하기 with UIKit | SDY - Developer Kas</title><meta name=keywords content="UIKit,System"><meta name=description content="본 포스팅은 Swift 5.2.4 기준으로 작성되었습니다.
이번 새로운 프로젝트 진행 중에 소셜 로그인 서비스를 제공하기로 결정되었는데요. 앱에서 소셜 로그인을 하나라도 제공하게 되면 Apple 로그인도 반드시 지원해야 합니다. 요즘 로그인이 필요한 앱들은 웬만하면 소셜 로그인도 지원하는 추세니까 Apple 로그인도 구현해야되고&mldr; 그러니까 지금 구현하는 방법을 알아두면 쓸 일이 많을거에요. 그럼 같이 한번 공부해볼까요~~
Apple Developer Documentation 처음 접하는 내용은 무엇보다 공식문서를 먼저 살펴봐야겠죠!
이런저런 내용이 있긴한데 우리에게 필요한 부분은 App 과 Services 에 유저가 쉽게 로그인 할 수 있도록 도와주는 Framework 라는 정도인 것 같아요."><meta name=author content="Doyoung Song"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9464825723074024" crossorigin=anonymous></script>
<link rel=canonical href=https://kasroid.github.io/posts/ios/20200829-sign-in-with-apple-uikit/><meta name=google-site-verification content="43_MOEW0diGtfoxWtXZ65iT24CFf_i63QMcMBiLkAUs"><link crossorigin=anonymous href=/assets/css/stylesheet.4dac38ca9863d46d0c6ccf5a89829d7b6d35bf0380185246fd6ba26a1140e6b7.css integrity="sha256-Taw4yphj1G0MbM9aiYKde201vwOAGFJG/WuiahFA5rc=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kasroid.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://kasroid.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kasroid.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kasroid.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kasroid.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-177150852-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="System - Sign in With Apple 구현하기 with UIKit"><meta property="og:description" content="본 포스팅은 Swift 5.2.4 기준으로 작성되었습니다.
이번 새로운 프로젝트 진행 중에 소셜 로그인 서비스를 제공하기로 결정되었는데요. 앱에서 소셜 로그인을 하나라도 제공하게 되면 Apple 로그인도 반드시 지원해야 합니다. 요즘 로그인이 필요한 앱들은 웬만하면 소셜 로그인도 지원하는 추세니까 Apple 로그인도 구현해야되고&mldr; 그러니까 지금 구현하는 방법을 알아두면 쓸 일이 많을거에요. 그럼 같이 한번 공부해볼까요~~
Apple Developer Documentation 처음 접하는 내용은 무엇보다 공식문서를 먼저 살펴봐야겠죠!
이런저런 내용이 있긴한데 우리에게 필요한 부분은 App 과 Services 에 유저가 쉽게 로그인 할 수 있도록 도와주는 Framework 라는 정도인 것 같아요."><meta property="og:type" content="article"><meta property="og:url" content="https://kasroid.github.io/posts/ios/20200829-sign-in-with-apple-uikit/"><meta property="og:image" content="https://kasroid.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-29T11:00:14+09:00"><meta property="article:modified_time" content="2020-08-29T11:00:14+09:00"><meta property="og:site_name" content="SDY - Dev Log"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kasroid.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="System - Sign in With Apple 구현하기 with UIKit"><meta name=twitter:description content="본 포스팅은 Swift 5.2.4 기준으로 작성되었습니다.
이번 새로운 프로젝트 진행 중에 소셜 로그인 서비스를 제공하기로 결정되었는데요. 앱에서 소셜 로그인을 하나라도 제공하게 되면 Apple 로그인도 반드시 지원해야 합니다. 요즘 로그인이 필요한 앱들은 웬만하면 소셜 로그인도 지원하는 추세니까 Apple 로그인도 구현해야되고&mldr; 그러니까 지금 구현하는 방법을 알아두면 쓸 일이 많을거에요. 그럼 같이 한번 공부해볼까요~~
Apple Developer Documentation 처음 접하는 내용은 무엇보다 공식문서를 먼저 살펴봐야겠죠!
이런저런 내용이 있긴한데 우리에게 필요한 부분은 App 과 Services 에 유저가 쉽게 로그인 할 수 있도록 도와주는 Framework 라는 정도인 것 같아요."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://kasroid.github.io/posts/"},{"@type":"ListItem","position":3,"name":"iOS","item":"https://kasroid.github.io/posts/ios/"},{"@type":"ListItem","position":4,"name":"System - Sign in With Apple 구현하기 with UIKit","item":"https://kasroid.github.io/posts/ios/20200829-sign-in-with-apple-uikit/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"System - Sign in With Apple 구현하기 with UIKit","name":"System - Sign in With Apple 구현하기 with UIKit","description":"본 포스팅은 Swift 5.2.4 기준으로 작성되었습니다.\n이번 새로운 프로젝트 진행 중에 소셜 로그인 서비스를 제공하기로 결정되었는데요. 앱에서 소셜 로그인을 하나라도 제공하게 되면 Apple 로그인도 반드시 지원해야 합니다. 요즘 로그인이 필요한 앱들은 웬만하면 소셜 로그인도 지원하는 추세니까 Apple 로그인도 구현해야되고\u0026hellip; 그러니까 지금 구현하는 방법을 알아두면 쓸 일이 많을거에요. 그럼 같이 한번 공부해볼까요~~\nApple Developer Documentation 처음 접하는 내용은 무엇보다 공식문서를 먼저 살펴봐야겠죠!\n이런저런 내용이 있긴한데 우리에게 필요한 부분은 App 과 Services 에 유저가 쉽게 로그인 할 수 있도록 도와주는 Framework 라는 정도인 것 같아요.","keywords":["UIKit","System"],"articleBody":" 본 포스팅은 Swift 5.2.4 기준으로 작성되었습니다.\n이번 새로운 프로젝트 진행 중에 소셜 로그인 서비스를 제공하기로 결정되었는데요. 앱에서 소셜 로그인을 하나라도 제공하게 되면 Apple 로그인도 반드시 지원해야 합니다. 요즘 로그인이 필요한 앱들은 웬만하면 소셜 로그인도 지원하는 추세니까 Apple 로그인도 구현해야되고… 그러니까 지금 구현하는 방법을 알아두면 쓸 일이 많을거에요. 그럼 같이 한번 공부해볼까요~~\nApple Developer Documentation 처음 접하는 내용은 무엇보다 공식문서를 먼저 살펴봐야겠죠!\n이런저런 내용이 있긴한데 우리에게 필요한 부분은 App 과 Services 에 유저가 쉽게 로그인 할 수 있도록 도와주는 Framework 라는 정도인 것 같아요. 코드 구현에 유용한 정보는 없어보이니 공식 문서는 이정도로 넘어가는걸로하고 그냥 직접 구현하면서 알아보도록 할게요!\nEntitlement 파일 생성하기 먼저 새로운 프로젝트를 만들고 Signing \u0026 Capabilities 카테고리로 넘어와 아래 이미지에서 빨간색 화살표로 표시된 + 버튼을 클릭해주세요.\n그러면 뭔가 익숙한 느낌의 새로운 창이 하나 뜹니다 ㅎㅎ 그러면 Sign 으로 검색하고 Sign In with Apple 을 찾아서 클릭해주세요.\n참고로 Apple 에 개발자로 등록되지 않은 분들은 Sign In with Apple 이 검색되지 않을 수도 있어요. 이럴때는 Team 을 None 으로 설정하고 검색하면 보일거에요.\n이제 .entitlements 확장자를 가진 새로운 파일이 하나 생겼을 거에요. 뭔가 생소한 파일이죠?? 다행히 이곳에서 추가로 작업할 내용은 없습니다 ㅎㅎㅎ\nImport AuthenticationServices 가장 먼저 우리가 해야할 일은 Apple 에서 로그인을 지원하기 위해 만든 인스턴스에 접근할 수 있도록 AuthenticationServices 를 import 해주어야 합니다.\nimport AuthenticationServices Sign In with Apple 버튼 생성하기 이제 ViewController 에 Sign In with Apple 버튼을 생성해보도록 할게요. 여기서는 일반 UIButton 을 사용하는게 아니라 ASAuthorizationAppleIDButton 으로 인스턴스를 생성해야 합니다.\nlet authorizationAppleIDButton = ASAuthorizationAppleIDButton() 처음보는 코드니까 당연히 공식문서를 보고 넘어가야겠죠?\n유저가 Sign In with Apple 을 시작할 수 있게 해주는 control 이라고 하네요. UIButton 처럼 UIControl 을 상속받고 있습니다. 그렇다면 어느정도 비슷한 성질을 가졌을 것 같네요. 이번엔 문서 아래쪽에 알아두면 좋을만한 내용이 있어 추가로 가져와봤어요.\n중간쯤에 Styling the Button 카테고리가 보이죠? 개발자가 cornerRadius 나 버튼의 style 을 일정 부분 수정할 수 있게 해놓은 것 같습니다. 이 부분은 나중에 시간날 때 직접 실험을 해보고 업데이트 하도록 할게요.\n그럼 이제 버튼을 화면의 중앙에 오도록 배치해봅시다. ASAuthorizationAppleIDButton 도 결국 버튼의 일종이므로 .addTarget method 를 사용해 원하는 Action 을 구현할 수 있도록 @objc method 와 연결해 주었습니다.\nimport UIKit import AuthenticationServices class ViewController: UIViewController { // MARK: - Properties let authorizationAppleIDButton = ASAuthorizationAppleIDButton() override func viewDidLoad() { super.viewDidLoad() configureUI() } // MARK: - UI private func configureUI() { setAdditionalPropertyAttributes() setConstraints() } private func setAdditionalPropertyAttributes() { authorizationAppleIDButton.addTarget(self, action: #selector(handleAuthorizationAppleIDButton(_:)), for: .touchUpInside) } private func setConstraints() { view.addSubview(authorizationAppleIDButton) authorizationAppleIDButton.translatesAutoresizingMaskIntoConstraints = false NSLayoutConstraint.activate([ authorizationAppleIDButton.centerXAnchor.constraint(equalTo: view.centerXAnchor), authorizationAppleIDButton.centerYAnchor.constraint(equalTo: view.centerYAnchor) ]) } // MARK: - Selectors @objc private func handleAuthorizationAppleIDButton(_ sender: ASAuthorizationAppleIDButton) { print(#function) } } 여기까지 코드를 작성하고 시뮬레이터를 실행해보면 이렇게 중앙에 버튼이 배치되고 정상적으로 handleAuthorizationAppleIDButton 함수 내부에 구현해둔 print 가 실행되는 것을 볼 수 있을거에요.\nLogin Process 구현하기 이제 UI작업은 마쳤으니 실제로 로그인이 데이터 처리에 필요한 코드를 작성해 보겠습니다. 당연한 얘기지만 로그인 과정은 버튼이 눌렸을 때 실행되도록 하면 되니까 handleAuthorizationAppleIDButton() 함수에 코드를 작성할거에요.\n로그인 과정을 처리하기 위해서 우리가 필수로 생성하고 접근해야하는 인스턴스는 ASAuthorizationAppleIDProvider 입니다.\nApple ID 를 사용해서 로그인 인증 요청을 생성해주는 메커니즘이라고하네요. 이번에는 Overview 부분도 주의깊게 봐야합니다. 우리가 생성해야할 provider, request, controller 에 대한 정보들이 있거든요. 그럼 이 정보들을 바탕으로 코드를 한번 작성해봅시다.\n@objc private func handleAuthorizationAppleIDButton(_ sender: ASAuthorizationAppleIDButton) { let provider = ASAuthorizationAppleIDProvider() let request = provider.createRequest() request.requestedScopes = [.fullName, .email] let controller = ASAuthorizationController(authorizationRequests: [request]) controller.performRequests() } 그냥 공식문서에 있는 것과 똑같이 작성했어요 ㅎㅎ Provider 를 통해 Request 를 생성하고 생성된 Request 를 Controller 에게 전달해줘서 Controller 가 요청을 실행하는 개념입니다.\n중간에 있는 .requestedScopes 는 우리가 유저로부터 전달받을 최소한의 정보를 요청할 수 있게 도와주는 method 입니다. 내부에 들어가보면 fullname 과 email 이렇게 최대 2가지만 요청할 수 있게 만들어져 있어요.\n물론 이 2가지마저도 사용자가 거부하면 우리가 받을 수 있는 것은 유저의 identifier 뿐으로 이것으로 최소한의 식별만 가능하게 됩니다. 역시 개인의 보안을 중시하는 애플이에요 ㅎㅎ\n하지만 이것으로 끝은 아닙니다. 아직 유저가 로그인에 성공하거나 실패했을 때 처리를 하지 않았고, 로그인 요청 창을 띄울 페이지도 설정해주지 않았거든요. 이 부분을 처리하기 위해서는 ASAuthorizationControllerDelegate 와 ASWebAuthenticationPresentationContextProviding 을 채택해야합니다.\nASAuthorizationControllerDelegate 를 채택하고 나면 로그인이 성공적으로 처리되었을 때 호출될 didCompleteWithAuthorization 함수와 실패했을 때 호출될 didCompleteWithError 함수를 불러올 수 있게 됩니다.\n그리고 ASWebAuthenticationPresentationContextProviding 에는 필수 구현 함수인 presentationAnchor() 에서 사용자에게 로그인 요청을 띄울 윈도우를 설정해줄 수 있습니다. 우리는 현재 View 의 Window 에서 바로 실행되도록 만들거에요. 자 그럼 지금까지 얘기한 내용들을 바로 코드로 구현해볼게요.\nextension ViewController: ASAuthorizationControllerDelegate { func authorizationController(controller: ASAuthorizationController, didCompleteWithAuthorization authorization: ASAuthorization) { } func authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error) { } } extension ViewController: ASAuthorizationControllerPresentationContextProviding { func presentationAnchor(for controller: ASAuthorizationController) -\u003e ASPresentationAnchor { return view.window! } } 이전에 만들어 두었던 handleAuthorizationAppleIDButton() 함수 내부의 controller 에게 delegate 와 provider 위임도 빼먹지 말고 꼭 해주세요!\ncontroller.delegate = self controller.presentationContextProvider = self 이제 거의 끝이 보입니다!\n먼저 로그인 정보가 성공적으로 들어왔을 때에 대한 처리 코드를 작성해볼게요. 당연히 didCompleteWithAuthorization 함수에 작성해야겠죠? 이 함수는 호출되면 ASAuthorization 타입을 가진 parameter 와 함께 실행됩니다. 잠깐 ASAuthorization 에 대해 알아보자면…\nController 가 성공적으로 인증을 진행했을 때 캡슐화해서 전달해주는 정보라고하네요. 내부에 credential 이라고하는 property 가 있고 이것은 성공적으로 인증된 사용자의 정보라고 합니다.. 지금은 캡슐화가 되어있는 상태이므로 credential 정보에 접근하기 위해 ASAuthorizationAppleIDCredential 타입으로 캐스팅이 필요합니다. 생소한 타입이죠?\n설명을 보면 encapsulation 이라는 단어가 사라지고 Apple ID 를 사용해 성공적으로 인증된 결과라고 써져있어요. 이것으로 타입 캐스팅을하면 캡슐이 해제되고 우리가 원하는 정보들에 접근할 수 있게됩니다. 문서의 Getting Contact Information 카테고리에 fullName 과 email 이 적혀있고 우리가 접근할 수 있을 것 같아요. 그리고 user 라는 property 가 매우 중요한데 일종의 identifier 로 우리가 무조건 받을 수 있는 소중한 정보입니다. 이 값으로 우리는 유저가 누구인지 판단을 해야하거든요.\nfunc authorizationController(controller: ASAuthorizationController, didCompleteWithAuthorization authorization: ASAuthorization) { if let appleIDCredential = authorization.credential as? ASAuthorizationAppleIDCredential { // Create an account in your system. let userIdentifier = appleIDCredential.user let userFirstName = appleIDCredential.fullName?.givenName let userLastName = appleIDCredential.fullName?.familyName let userEmail = appleIDCredential.email } 그리고 fullName 은 .givenName 과 .familyName 으로 나눠서 받을 수도 있어요. 이렇게 첫 가입절차에서 사용자의 정보를 가져오는 코드를 완성했습니다. 이제 사용자가 최초 가입 후 로그인을 마치고 다음 로그인 시부터 우리가 사용자를 식별하여 로그인을 수 있도록 도와주는 코드를 작성해보겠습니다.\nlet appleIDProvider = ASAuthorizationAppleIDProvider() appleIDProvider.getCredentialState(forUserID: userIdentifier) { (credentialState, error) in switch credentialState { case .authorized: // The Apple ID credential is valid. Show Home UI Here break case .revoked: // The Apple ID credential is revoked. Show SignIn UI Here. break case .notFound: // No credential was found. Show SignIn UI Here. break default: break } } authorized - 사용자의 identifier 가 정상적으로 인식되었을 경우\nrevoked- 사용자의 identifier 가 유효하지 않은 경우\nnotFoun - 사용자의 identifier 를 찾지 못한 경우\nCredentialState 에는 경우의 수가 총 3가지가 있고 상황에 맞는 코드를 각 case 에 작성해주면 됩니다. 우리는 추가 작업이 필요하지 않으므로 따로 작성하지 않겠습니다.\n에러처리는 따로 작성해주지 않아도 무방하지만 그래도 에러발생 시 우리가 알 수 있도록 print 를 하나 남겨두겠습니다.\nfunc authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error) { print(error) } 이제 앱을 한번 실행해볼게요.\n이렇게 가입이 정상적으로 진행됩니다. Print 로 내가 가입 시 제공한 정보(이메일 및 이름)들과 identifier 가 console 에 출력될거에요. 하지만 첫번째를 제외한 이후 로그인 부터는 identifier 만 print 되고 나머지는 nil 값이 들어옵니다. 그럼 이번 포스팅은 이것으로 마치겠습니다.\n함께 참고하면 좋은 포스트 ","wordCount":"1122","inLanguage":"en","image":"https://kasroid.github.io/%3Cimage%20path/url%3E","datePublished":"2020-08-29T11:00:14+09:00","dateModified":"2020-08-29T11:00:14+09:00","author":{"@type":"Person","name":"Doyoung Song"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kasroid.github.io/posts/ios/20200829-sign-in-with-apple-uikit/"},"publisher":{"@type":"Organization","name":"SDY - Developer Kas","logo":{"@type":"ImageObject","url":"https://kasroid.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kasroid.github.io accesskey=h title="SDY (Alt + H)">SDY</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://kasroid.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://kasroid.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://kasroid.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kasroid.github.io>Home</a>&nbsp;»&nbsp;<a href=https://kasroid.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://kasroid.github.io/posts/ios/>iOS</a></div><h1 class=post-title>System - Sign in With Apple 구현하기 with UIKit</h1><div class=post-meta><span title='2020-08-29 11:00:14 +0900 KST'>2020-08-29</span>&nbsp;·&nbsp;Doyoung Song</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#apple-developer-documentation>Apple Developer Documentation</a></li><li><a href=#entitlement-파일-생성하기>Entitlement 파일 생성하기</a></li><li><a href=#import-authenticationservices>Import AuthenticationServices</a></li><li><a href=#sign-in-with-apple-버튼-생성하기>Sign In with Apple 버튼 생성하기</a></li><li><a href=#login-process-구현하기>Login Process 구현하기</a></li><li><a href=#함께-참고하면-좋은-포스트>함께 참고하면 좋은 포스트</a></li></ul></nav></div></details></div><div class=post-content><blockquote><p>본 포스팅은 Swift 5.2.4 기준으로 작성되었습니다.</p></blockquote><p>이번 새로운 프로젝트 진행 중에 소셜 로그인 서비스를 제공하기로 결정되었는데요. 앱에서 소셜 로그인을 하나라도 제공하게 되면 Apple 로그인도 반드시 지원해야 합니다. 요즘 로그인이 필요한 앱들은 웬만하면 소셜 로그인도 지원하는 추세니까 Apple 로그인도 구현해야되고&mldr; 그러니까 지금 구현하는 방법을 알아두면 쓸 일이 많을거에요. 그럼 같이 한번 공부해볼까요~~</p><hr><h2 id=apple-developer-documentation>Apple Developer Documentation<a hidden class=anchor aria-hidden=true href=#apple-developer-documentation>#</a></h2><p>처음 접하는 내용은 무엇보다 공식문서를 먼저 살펴봐야겠죠!</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdNp10r%2FbtqGbjztlvZ%2FrKTcRAC7q3tuRBCHBKdlk0%2Fimg.png" alt="Apple 공식문서의 AuthenticationServices"></p><p>이런저런 내용이 있긴한데 우리에게 필요한 부분은 App 과 Services 에 유저가 쉽게 로그인 할 수 있도록 도와주는 Framework 라는 정도인 것 같아요. 코드 구현에 유용한 정보는 없어보이니 공식 문서는 이정도로 넘어가는걸로하고 그냥 직접 구현하면서 알아보도록 할게요!</p><hr><h2 id=entitlement-파일-생성하기>Entitlement 파일 생성하기<a hidden class=anchor aria-hidden=true href=#entitlement-파일-생성하기>#</a></h2><p>먼저 새로운 프로젝트를 만들고 <strong>Signing & Capabilities</strong> 카테고리로 넘어와 아래 이미지에서 빨간색 화살표로 표시된 <strong>+</strong> 버튼을 클릭해주세요.</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FQ9xAs%2FbtqGe9vtmiM%2FPUSCeM3D4iJRlYtFnL37UK%2Fimg.png" alt="Entitlement 파일 생성 버튼"></p><p>그러면 뭔가 익숙한 느낌의 새로운 창이 하나 뜹니다 ㅎㅎ 그러면 Sign 으로 검색하고 <strong>Sign In with Apple</strong> 을 찾아서 클릭해주세요.</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbX2AwO%2FbtqGbHN03xM%2Fgw9fns2jabKRU0wrUPbjD0%2Fimg.png" alt="Sign In with Apple 검색"></p><p>참고로 Apple 에 개발자로 등록되지 않은 분들은 Sign In with Apple 이 검색되지 않을 수도 있어요. 이럴때는 <strong>Team</strong> 을 <strong>None</strong> 으로 설정하고 검색하면 보일거에요.</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FCMq8p%2FbtqGiTUi4DT%2F3DwenpNzuxvcg2knHXrx8K%2Fimg.png" alt="Team 설정"></p><p>이제 .entitlements 확장자를 가진 새로운 파일이 하나 생겼을 거에요. 뭔가 생소한 파일이죠?? 다행히 이곳에서 추가로 작업할 내용은 없습니다 ㅎㅎㅎ</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fb8r5Je%2FbtqGfNyWHmo%2FbVicWmEJervLR9kmDMLGgk%2Fimg.png" alt="entitlement 파일 스크린샷"></p><hr><h2 id=import-authenticationservices>Import AuthenticationServices<a hidden class=anchor aria-hidden=true href=#import-authenticationservices>#</a></h2><p>가장 먼저 우리가 해야할 일은 Apple 에서 로그인을 지원하기 위해 만든 인스턴스에 접근할 수 있도록 <strong>AuthenticationServices</strong> 를 import 해주어야 합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>import</span> <span class=nc>AuthenticationServices</span>
</span></span></code></pre></div><hr><h2 id=sign-in-with-apple-버튼-생성하기>Sign In with Apple 버튼 생성하기<a hidden class=anchor aria-hidden=true href=#sign-in-with-apple-버튼-생성하기>#</a></h2><p>이제 ViewController 에 <strong>Sign In with Apple</strong> 버튼을 생성해보도록 할게요. 여기서는 일반 UIButton 을 사용하는게 아니라 <code>ASAuthorizationAppleIDButton</code> 으로 인스턴스를 생성해야 합니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>let</span> <span class=nv>authorizationAppleIDButton</span> <span class=p>=</span> <span class=n>ASAuthorizationAppleIDButton</span><span class=p>()</span>
</span></span></code></pre></div><p>처음보는 코드니까 당연히 공식문서를 보고 넘어가야겠죠?</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbUAOZc%2FbtqGchhnEQp%2FQNIIp0nE7sDyZVrj1PJgpK%2Fimg.png" alt="Apple 공식문서의 ASAuthorizationAppleIDButton"></p><p>유저가 <strong>Sign In with Apple</strong> 을 시작할 수 있게 해주는 control 이라고 하네요. UIButton 처럼 <strong>UIControl</strong> 을 상속받고 있습니다. 그렇다면 어느정도 비슷한 성질을 가졌을 것 같네요. 이번엔 문서 아래쪽에 알아두면 좋을만한 내용이 있어 추가로 가져와봤어요.</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fby4wXT%2FbtqGcgJwtvl%2FbWF4zHNX90xWDbzdbPdxZK%2Fimg.png" alt="Apple 공식문서의 ASAuthorizationAppleIDButton 2"></p><p>중간쯤에 Styling the Button 카테고리가 보이죠? 개발자가 <strong>cornerRadius</strong> 나 버튼의 <strong>style</strong> 을 일정 부분 수정할 수 있게 해놓은 것 같습니다. 이 부분은 나중에 시간날 때 직접 실험을 해보고 업데이트 하도록 할게요.</p><p>그럼 이제 버튼을 화면의 중앙에 오도록 배치해봅시다. <code>ASAuthorizationAppleIDButton</code> 도 결국 버튼의 일종이므로 <code>.addTarget</code> method 를 사용해 원하는 Action 을 구현할 수 있도록 <code>@objc</code> method 와 연결해 주었습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>import</span> <span class=nc>UIKit</span>
</span></span><span class=line><span class=cl><span class=kd>import</span> <span class=nc>AuthenticationServices</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>ViewController</span><span class=p>:</span> <span class=n>UIViewController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// </span><span class=cs>MARK:</span><span class=c1> - Properties</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>authorizationAppleIDButton</span> <span class=p>=</span> <span class=n>ASAuthorizationAppleIDButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>override</span> <span class=kd>func</span> <span class=nf>viewDidLoad</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kc>super</span><span class=p>.</span><span class=n>viewDidLoad</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>configureUI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// </span><span class=cs>MARK:</span><span class=c1> - UI</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>func</span> <span class=nf>configureUI</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>setAdditionalPropertyAttributes</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>setConstraints</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>func</span> <span class=nf>setAdditionalPropertyAttributes</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>authorizationAppleIDButton</span><span class=p>.</span><span class=n>addTarget</span><span class=p>(</span><span class=kc>self</span><span class=p>,</span> <span class=n>action</span><span class=p>:</span> <span class=k>#selector</span><span class=p>(</span><span class=n>handleAuthorizationAppleIDButton</span><span class=p>(</span><span class=kc>_</span><span class=p>:)),</span> <span class=k>for</span><span class=p>:</span> <span class=p>.</span><span class=n>touchUpInside</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>func</span> <span class=nf>setConstraints</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>view</span><span class=p>.</span><span class=n>addSubview</span><span class=p>(</span><span class=n>authorizationAppleIDButton</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>authorizationAppleIDButton</span><span class=p>.</span><span class=n>translatesAutoresizingMaskIntoConstraints</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>NSLayoutConstraint</span><span class=p>.</span><span class=n>activate</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=n>authorizationAppleIDButton</span><span class=p>.</span><span class=n>centerXAnchor</span><span class=p>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>equalTo</span><span class=p>:</span> <span class=n>view</span><span class=p>.</span><span class=n>centerXAnchor</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>authorizationAppleIDButton</span><span class=p>.</span><span class=n>centerYAnchor</span><span class=p>.</span><span class=n>constraint</span><span class=p>(</span><span class=n>equalTo</span><span class=p>:</span> <span class=n>view</span><span class=p>.</span><span class=n>centerYAnchor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// </span><span class=cs>MARK:</span><span class=c1> - Selectors</span>
</span></span><span class=line><span class=cl>    <span class=kr>@objc</span> <span class=kd>private</span> <span class=kd>func</span> <span class=nf>handleAuthorizationAppleIDButton</span><span class=p>(</span><span class=kc>_</span> <span class=n>sender</span><span class=p>:</span> <span class=n>ASAuthorizationAppleIDButton</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=bp>print</span><span class=p>(</span><span class=kc>#function</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>여기까지 코드를 작성하고 시뮬레이터를 실행해보면 이렇게 중앙에 버튼이 배치되고 정상적으로 <code>handleAuthorizationAppleIDButton</code> 함수 내부에 구현해둔 print 가 실행되는 것을 볼 수 있을거에요.</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fnpd9X%2FbtqGdD5leqo%2FhodOCdFMtz8KpL1WuPZxOK%2Fimg.png" alt="Simulator 실행화면"></p><hr><h2 id=login-process-구현하기>Login Process 구현하기<a hidden class=anchor aria-hidden=true href=#login-process-구현하기>#</a></h2><p>이제 UI작업은 마쳤으니 실제로 로그인이 데이터 처리에 필요한 코드를 작성해 보겠습니다. 당연한 얘기지만 로그인 과정은 버튼이 눌렸을 때 실행되도록 하면 되니까 <code>handleAuthorizationAppleIDButton()</code> 함수에 코드를 작성할거에요.</p><p>로그인 과정을 처리하기 위해서 우리가 필수로 생성하고 접근해야하는 인스턴스는 <code>ASAuthorizationAppleIDProvider</code> 입니다.</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbiQElo%2FbtqGeufLNXc%2FO06TV2DYskSjliKPjZByt0%2Fimg.png" alt="Apple 공식문서의 ASAuthorizationAppleIDProvider"></p><p>Apple ID 를 사용해서 로그인 인증 요청을 생성해주는 메커니즘이라고하네요. 이번에는 Overview 부분도 주의깊게 봐야합니다. 우리가 생성해야할 <strong>provider</strong>, <strong>request</strong>, <strong>controller</strong> 에 대한 정보들이 있거든요. 그럼 이 정보들을 바탕으로 코드를 한번 작성해봅시다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kr>@objc</span> <span class=kd>private</span> <span class=kd>func</span> <span class=nf>handleAuthorizationAppleIDButton</span><span class=p>(</span><span class=kc>_</span> <span class=n>sender</span><span class=p>:</span> <span class=n>ASAuthorizationAppleIDButton</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>provider</span> <span class=p>=</span> <span class=n>ASAuthorizationAppleIDProvider</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>request</span> <span class=p>=</span> <span class=n>provider</span><span class=p>.</span><span class=n>createRequest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>request</span><span class=p>.</span><span class=n>requestedScopes</span> <span class=p>=</span> <span class=p>[.</span><span class=n>fullName</span><span class=p>,</span> <span class=p>.</span><span class=n>email</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>controller</span> <span class=p>=</span> <span class=n>ASAuthorizationController</span><span class=p>(</span><span class=n>authorizationRequests</span><span class=p>:</span> <span class=p>[</span><span class=n>request</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>controller</span><span class=p>.</span><span class=n>performRequests</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>그냥 공식문서에 있는 것과 똑같이 작성했어요 ㅎㅎ Provider 를 통해 Request 를 생성하고 생성된 Request 를 Controller 에게 전달해줘서 Controller 가 요청을 실행하는 개념입니다.</p><p>중간에 있는 <code>.requestedScopes</code> 는 우리가 유저로부터 전달받을 최소한의 정보를 요청할 수 있게 도와주는 method 입니다. 내부에 들어가보면 <strong>fullname</strong> 과 <strong>email</strong> 이렇게 최대 2가지만 요청할 수 있게 만들어져 있어요.</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcbMXgx%2FbtqGbrkxlPF%2FkyLMKbilgArt77K5EFp6SK%2Fimg.png" alt=".requestedScopes 의 내부코드"></p><p>물론 이 2가지마저도 사용자가 거부하면 우리가 받을 수 있는 것은 유저의 identifier 뿐으로 이것으로 최소한의 식별만 가능하게 됩니다. 역시 개인의 보안을 중시하는 애플이에요 ㅎㅎ</p><p>하지만 이것으로 끝은 아닙니다. 아직 유저가 로그인에 성공하거나 실패했을 때 처리를 하지 않았고, 로그인 요청 창을 띄울 페이지도 설정해주지 않았거든요. 이 부분을 처리하기 위해서는 <code>ASAuthorizationControllerDelegate</code> 와 <code>ASWebAuthenticationPresentationContextProviding</code> 을 채택해야합니다.</p><p><code>ASAuthorizationControllerDelegate</code> 를 채택하고 나면 로그인이 성공적으로 처리되었을 때 호출될 <code>didCompleteWithAuthorization</code> 함수와 실패했을 때 호출될 <code>didCompleteWithError</code> 함수를 불러올 수 있게 됩니다.</p><p>그리고 <code>ASWebAuthenticationPresentationContextProviding</code> 에는 필수 구현 함수인 <code>presentationAnchor()</code> 에서 사용자에게 로그인 요청을 띄울 윈도우를 설정해줄 수 있습니다. 우리는 현재 View 의 Window 에서 바로 실행되도록 만들거에요. 자 그럼 지금까지 얘기한 내용들을 바로 코드로 구현해볼게요.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>extension</span> <span class=nc>ViewController</span><span class=p>:</span> <span class=n>ASAuthorizationControllerDelegate</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>authorizationController</span><span class=p>(</span><span class=n>controller</span><span class=p>:</span> <span class=n>ASAuthorizationController</span><span class=p>,</span> <span class=n>didCompleteWithAuthorization</span> <span class=n>authorization</span><span class=p>:</span> <span class=n>ASAuthorization</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>authorizationController</span><span class=p>(</span><span class=n>controller</span><span class=p>:</span> <span class=n>ASAuthorizationController</span><span class=p>,</span> <span class=n>didCompleteWithError</span> <span class=n>error</span><span class=p>:</span> <span class=n>Error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>extension</span> <span class=nc>ViewController</span><span class=p>:</span> <span class=n>ASAuthorizationControllerPresentationContextProviding</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>presentationAnchor</span><span class=p>(</span><span class=k>for</span> <span class=n>controller</span><span class=p>:</span> <span class=n>ASAuthorizationController</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=n>ASPresentationAnchor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>view</span><span class=p>.</span><span class=n>window</span><span class=p>!</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>이전에 만들어 두었던 <code>handleAuthorizationAppleIDButton()</code> 함수 내부의 controller 에게 <strong>delegate</strong> 와 <strong>provider</strong> 위임도 빼먹지 말고 꼭 해주세요!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=n>controller</span><span class=p>.</span><span class=n>delegate</span> <span class=p>=</span> <span class=kc>self</span>
</span></span><span class=line><span class=cl><span class=n>controller</span><span class=p>.</span><span class=n>presentationContextProvider</span> <span class=p>=</span> <span class=kc>self</span>
</span></span></code></pre></div><p>이제 거의 끝이 보입니다!</p><p>먼저 로그인 정보가 성공적으로 들어왔을 때에 대한 처리 코드를 작성해볼게요. 당연히 <code>didCompleteWithAuthorization</code> 함수에 작성해야겠죠? 이 함수는 호출되면 <strong>ASAuthorization</strong> 타입을 가진 parameter 와 함께 실행됩니다. 잠깐 <strong>ASAuthorization</strong> 에 대해 알아보자면&mldr;</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbCgyLl%2FbtqGebAC1fT%2FbJ3fc7my35fmd1tVd58IoK%2Fimg.png" alt="Apple 공식문서의 ASAuthorization"></p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbPztcT%2FbtqGevS85Ix%2FfXlJdcPlgNF9OHEoDpQODk%2Fimg.png" alt="Apple 공식문서의 ASAuthorization 2"></p><p>Controller 가 성공적으로 인증을 진행했을 때 캡슐화해서 전달해주는 정보라고하네요. 내부에 <strong>credential</strong> 이라고하는 property 가 있고 이것은 성공적으로 인증된 사용자의 정보라고 합니다.. 지금은 캡슐화가 되어있는 상태이므로 <strong>credential</strong> 정보에 접근하기 위해 <strong>ASAuthorizationAppleIDCredential</strong> 타입으로 캐스팅이 필요합니다. 생소한 타입이죠?</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FAfI3n%2FbtqGe8XK9qT%2FUt5K1fhfdgYw86ola0aCkk%2Fimg.png" alt="Apple 공식문서의 ASAuthorizationAppleIDCredential"></p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbyG1aA%2FbtqGdthHid0%2Fef21K8UmkKpUkyitmZkGWk%2Fimg.png" alt="Apple 공식문서의 ASAuthorizationAppleIDCredential 2"></p><p>설명을 보면 encapsulation 이라는 단어가 사라지고 Apple ID 를 사용해 성공적으로 인증된 결과라고 써져있어요. 이것으로 타입 캐스팅을하면 캡슐이 해제되고 우리가 원하는 정보들에 접근할 수 있게됩니다. 문서의 Getting Contact Information 카테고리에 <code>fullName</code> 과 <code>email</code> 이 적혀있고 우리가 접근할 수 있을 것 같아요. 그리고 <code>user</code> 라는 property 가 매우 중요한데 일종의 <strong>identifier</strong> 로 우리가 무조건 받을 수 있는 소중한 정보입니다. 이 값으로 우리는 유저가 누구인지 판단을 해야하거든요.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>authorizationController</span><span class=p>(</span><span class=n>controller</span><span class=p>:</span> <span class=n>ASAuthorizationController</span><span class=p>,</span> <span class=n>didCompleteWithAuthorization</span> <span class=n>authorization</span><span class=p>:</span> <span class=n>ASAuthorization</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=kd>let</span> <span class=nv>appleIDCredential</span> <span class=p>=</span> <span class=n>authorization</span><span class=p>.</span><span class=n>credential</span> <span class=k>as</span><span class=p>?</span> <span class=n>ASAuthorizationAppleIDCredential</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Create an account in your system.</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>userIdentifier</span> <span class=p>=</span> <span class=n>appleIDCredential</span><span class=p>.</span><span class=n>user</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>userFirstName</span> <span class=p>=</span> <span class=n>appleIDCredential</span><span class=p>.</span><span class=n>fullName</span><span class=p>?.</span><span class=n>givenName</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>userLastName</span> <span class=p>=</span> <span class=n>appleIDCredential</span><span class=p>.</span><span class=n>fullName</span><span class=p>?.</span><span class=n>familyName</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nv>userEmail</span> <span class=p>=</span> <span class=n>appleIDCredential</span><span class=p>.</span><span class=n>email</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>그리고 <code>fullName</code> 은 <code>.givenName</code> 과 <code>.familyName</code> 으로 나눠서 받을 수도 있어요. 이렇게 첫 가입절차에서 사용자의 정보를 가져오는 코드를 완성했습니다. 이제 사용자가 최초 가입 후 로그인을 마치고 다음 로그인 시부터 우리가 사용자를 식별하여 로그인을 수 있도록 도와주는 코드를 작성해보겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>let</span> <span class=nv>appleIDProvider</span> <span class=p>=</span> <span class=n>ASAuthorizationAppleIDProvider</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>appleIDProvider</span><span class=p>.</span><span class=n>getCredentialState</span><span class=p>(</span><span class=n>forUserID</span><span class=p>:</span> <span class=n>userIdentifier</span><span class=p>)</span> <span class=p>{</span> <span class=p>(</span><span class=n>credentialState</span><span class=p>,</span> <span class=n>error</span><span class=p>)</span> <span class=k>in</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=n>credentialState</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=p>.</span><span class=n>authorized</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1>// The Apple ID credential is valid. Show Home UI Here</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=p>.</span><span class=n>revoked</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1>// The Apple ID credential is revoked. Show SignIn UI Here.</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=p>.</span><span class=n>notFound</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1>// No credential was found. Show SignIn UI Here.</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>authorized</strong> - 사용자의 identifier 가 <strong>정상적으로</strong> 인식되었을 경우<br><strong>revoked</strong>- 사용자의 identifier 가 <strong>유효하지 않은</strong> 경우<br><strong>notFoun</strong> - 사용자의 identifier 를 <strong>찾지 못한</strong> 경우</p><p><strong>CredentialState</strong> 에는 경우의 수가 총 3가지가 있고 상황에 맞는 코드를 각 case 에 작성해주면 됩니다. 우리는 추가 작업이 필요하지 않으므로 따로 작성하지 않겠습니다.</p><p>에러처리는 따로 작성해주지 않아도 무방하지만 그래도 에러발생 시 우리가 알 수 있도록 print 를 하나 남겨두겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>func</span> <span class=nf>authorizationController</span><span class=p>(</span><span class=n>controller</span><span class=p>:</span> <span class=n>ASAuthorizationController</span><span class=p>,</span> <span class=n>didCompleteWithError</span> <span class=n>error</span><span class=p>:</span> <span class=n>Error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=bp>print</span><span class=p>(</span><span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>이제 앱을 한번 실행해볼게요.</p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcQav98%2FbtqGc8rpXao%2FLkKCEUV8dYrF1MplHwXM11%2Fimg.png" alt="Simulator 실행화면"></p><p><img loading=lazy src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fk1XaG%2FbtqGdEpVPLE%2F4KgZrwmU8MBhNkQoGJbqIk%2Fimg.png" alt="Simulator 실행화면 2"></p><p>이렇게 가입이 정상적으로 진행됩니다. Print 로 내가 가입 시 제공한 정보(이메일 및 이름)들과 <strong>identifier</strong> 가 console 에 출력될거에요. 하지만 첫번째를 제외한 이후 로그인 부터는 <strong>identifier</strong> 만 print 되고 나머지는 <strong>nil</strong> 값이 들어옵니다. 그럼 이번 포스팅은 이것으로 마치겠습니다.</p><hr><h2 id=함께-참고하면-좋은-포스트>함께 참고하면 좋은 포스트<a hidden class=anchor aria-hidden=true href=#함께-참고하면-좋은-포스트>#</a></h2><p><img loading=lazy src alt="Apple Sign In: 계정 로그아웃하기"></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kasroid.github.io/tags/uikit/>UIKit</a></li><li><a href=https://kasroid.github.io/tags/system/>System</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://kasroid.github.io>SDY - Developer Kas</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>